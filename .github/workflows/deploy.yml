name: CD - Deploy with Docker Compose

# –ó–ê–î–ê–ù–ò–ï 3: –í CD –ø–∞–π–ø–ª–∞–π–Ω–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ docker compose
on:
  push:
    branches: [ lab4 ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Show structure
      run: |
        echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:"
        find . -name "*.yaml" -o -name "*.yml" | sort
        echo ""
        echo "üìÑ Docker Compose —Ñ–∞–π–ª:"
        if [ -f "docker-compose.yaml" ]; then
          head -20 docker-compose.yaml
        else
          echo "docker-compose.yaml –Ω–µ –Ω–∞–π–¥–µ–Ω!"
        fi
        
    - name: –ó–ê–î–ê–ù–ò–ï 3 - Deploy with Docker Compose
      run: |
        echo "üéØ –í–´–ü–û–õ–ù–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø 3"
        echo "========================"
        echo "–ö–æ–º–∞–Ω–¥–∞: docker compose up -d"
        echo ""
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Docker Compose
        docker compose up -d
        
        # –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
        sleep 15
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        echo ""
        echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:"
        echo "------------"
        docker compose ps
        
        echo ""
        echo "‚úÖ –ó–ê–î–ê–ù–ò–ï 3 –í–´–ü–û–õ–ù–ï–ù–û!"
        echo "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ —á–µ—Ä–µ–∑ Docker Compose"
        
    - name: Cleanup
      if: always()
      run: docker compose down
