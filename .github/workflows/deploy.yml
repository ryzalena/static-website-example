name: Deploy with Docker Compose

on:
  push:
    branches: [ lab4, main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Docker
      uses: docker/setup-buildx-action@v3
      
    - name: Deploy application
      run: |
        # ЗАДАНИЕ 3: Развертывание через Docker Compose
        echo "=== Задание 3: Развертывание через docker compose ==="
        
        # 1. Проверка Docker Compose
        docker compose version
        
        # 2. Запуск приложения
        docker compose up -d
        
        # 3. Проверка
        sleep 10
        docker compose ps
        
        # 4. Проверка доступности
        curl -f http://localhost:8088 || exit 1
        
        echo "✅ Приложение успешно развернуто через Docker Compose!"
